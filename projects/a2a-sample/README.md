# A2A Multi-Agent System

🌐 **Language**: [한국어](./README.md) | [English](./README_EN.md)

> A2A 프로토콜 기반 멀티 에이전트 오케스트레이션 시스템

![Platform](https://img.shields.io/badge/platform-Server-lightgrey)
![Python](https://img.shields.io/badge/Python-3.11+-blue)
![FastAPI](https://img.shields.io/badge/FastAPI-green)
![Azure OpenAI](https://img.shields.io/badge/Azure%20OpenAI-0078D4)

---

## 개요

**A2A Multi-Agent System**은 A2A(Agent-to-Agent) 프로토콜을 활용한 멀티 에이전트 시스템입니다. 중앙 오케스트레이션 에이전트가 HTTP 기반 레지스트리를 통해 여러 서비스 에이전트를 관리하고 조율합니다.

복잡한 사용자 요청을 여러 에이전트의 협업을 통해 처리하며, 동적 확장성과 컨텍스트 관리를 지원합니다.

---

## 주요 기능

### 에이전트 카드 기반 인텔리전스
- 등록된 에이전트 메타데이터를 활용하여 LLM 프롬프트 동적 생성
- 코드 수정 없이 실시간 기능 인식
- 에이전트 능력 기반 자동 라우팅

### 컨텍스트 관리
- 세션 기반 정보 공유를 통한 멀티 도메인 요청 처리
- 순차적 및 병렬 실행 패턴 지원
- 에이전트 간 컨텍스트 자동 전달

### 자기 호출 방지
- 복잡한 요청 처리 시 무한 루프 방지 메커니즘
- 에이전트 체인 추적 및 관리

### 동적 확장성
- 레지스트리 시스템을 통한 새로운 에이전트 자동 통합
- 기존 컴포넌트 수정 없이 기능 확장

---

## 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                    A2A Multi-Agent System                        │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                    Client Layer                             │ │
│  │  ┌──────────────────────────────────────────────────────┐  │ │
│  │  │                   client.py                           │  │ │
│  │  │              (사용자 요청 인터페이스)                   │  │ │
│  │  └──────────────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────────────┘ │
│                              │                                   │
│                              ▼                                   │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │              Main Agent (Port 18000)                        │ │
│  │  ┌──────────────┐ ┌──────────────┐ ┌──────────────────┐    │ │
│  │  │  Registry    │ │   Intent     │ │   Orchestration  │    │ │
│  │  │  Manager     │ │   Analyzer   │ │     Engine       │    │ │
│  │  └──────────────┘ └──────────────┘ └──────────────────┘    │ │
│  │  ┌──────────────────────────────────────────────────────┐  │ │
│  │  │              Context Manager                          │  │ │
│  │  │         (세션 기반 정보 공유 및 관리)                  │  │ │
│  │  └──────────────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────────────┘ │
│                              │                                   │
│              ┌───────────────┴───────────────┐                  │
│              ▼                               ▼                  │
│  ┌─────────────────────┐       ┌─────────────────────┐         │
│  │  Weather Agent      │       │    TV Agent         │         │
│  │  (Port 18001)       │       │   (Port 18002)      │         │
│  │  ┌───────────────┐  │       │  ┌───────────────┐  │         │
│  │  │ 날씨 정보     │  │       │  │ TV 제어       │  │         │
│  │  │ 예보 제공     │  │       │  │ 채널 변경     │  │         │
│  │  └───────────────┘  │       │  └───────────────┘  │         │
│  └─────────────────────┘       └─────────────────────┘         │
│                                                                  │
│  ┌────────────────────────────────────────────────────────────┐ │
│  │                    LLM Layer                                │ │
│  │  ┌──────────────────────────────────────────────────────┐  │ │
│  │  │                 Azure OpenAI                          │  │ │
│  │  │            (의도 분석 및 응답 생성)                    │  │ │
│  │  └──────────────────────────────────────────────────────┘  │ │
│  └────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

---

## 에이전트 구성

| 에이전트 | 포트 | 역할 |
|----------|------|------|
| **Main Agent** | 18000 | 오케스트레이션, 레지스트리 관리, 의도 분석 |
| **Weather Agent** | 18001 | 날씨 정보 및 예보 제공 |
| **TV Agent** | 18002 | TV 제어 및 채널 변경 |

---

## 기술 스택

| 분류 | 기술 |
|------|------|
| **Language** | Python 3.11+ |
| **Web Framework** | FastAPI |
| **LLM** | Azure OpenAI |
| **Protocol** | A2A SDK |
| **Package Manager** | uv |
| **Communication** | HTTP/REST |

---

## 워크플로우 예시

### 단순 쿼리
```
사용자: "오늘 서울 날씨 어때?"
```
→ Main Agent가 의도 분석 후 Weather Agent로 라우팅
→ Weather Agent가 서울 날씨 정보 반환

### 복합 요청 (멀티 에이전트 협업)
```
사용자: "오늘같은 날씨에 어울리는 채널로 변경해줘"
```
1. Main Agent가 복합 요청 인식
2. Weather Agent → 현재 날씨 조건 조회
3. Context Manager → 날씨 데이터 추출 및 공유
4. TV Agent → 날씨에 맞는 채널 추천 및 변경

---

## 프로젝트 구조

```
a2a-sample/
├── main.py                 # 메인 에이전트 엔트리포인트
├── client.py               # 클라이언트 인터페이스
├── agents/
│   ├── main_agent.py       # 오케스트레이션 에이전트
│   ├── weather_agent.py    # 날씨 서비스 에이전트
│   └── tv_agent.py         # TV 제어 에이전트
├── prompts/
│   └── templates/          # LLM 프롬프트 템플릿
├── utils/
│   ├── intent_analyzer.py  # 의도 분석 유틸리티
│   └── context_manager.py  # 컨텍스트 관리 유틸리티
└── api/
    ├── registry.py         # 레지스트리 API
    └── message.py          # 메시지 핸들링 API
```

---

## 개발 과정에서의 도전과 해결

### 1. 에이전트 간 컨텍스트 공유
**도전**: 복합 요청 처리 시 여러 에이전트 간에 정보를 효율적으로 공유해야 했습니다.

**해결**: 세션 기반 Context Manager를 구현하여 에이전트 간 정보 흐름을 관리하고, 순차적/병렬 실행 패턴을 모두 지원하도록 설계했습니다.

### 2. 동적 에이전트 발견 및 라우팅
**도전**: 새로운 에이전트가 추가될 때마다 코드 수정 없이 자동으로 인식하고 활용해야 했습니다.

**해결**: Agent Card 메타데이터를 활용한 레지스트리 시스템을 구축하여, LLM이 등록된 에이전트의 능력을 동적으로 파악하고 적절히 라우팅하도록 구현했습니다.

### 3. 무한 루프 방지
**도전**: 복잡한 멀티 에이전트 체인에서 자기 호출로 인한 무한 루프 가능성이 있었습니다.

**해결**: 에이전트 호출 체인을 추적하고, 자기 참조를 감지하여 차단하는 메커니즘을 구현했습니다.

---

## 역할 및 기여

- A2A 프로토콜 기반 멀티 에이전트 시스템 아키텍처 설계
- Main Agent 오케스트레이션 엔진 개발
- Context Manager 세션 관리 시스템 구현
- 에이전트 레지스트리 및 동적 라우팅 시스템 개발
- Azure OpenAI 연동 의도 분석 모듈 구현

---

## 시스템 요구사항

| 항목 | 요구사항 |
|------|----------|
| **Python** | 3.11 이상 |
| **패키지 매니저** | uv |
| **LLM** | Azure OpenAI API 접근 권한 |

---

## 빠른 시작

```bash
# 저장소 클론
git clone https://github.com/leonardo204/a2a_sample.git
cd a2a-sample

# 의존성 설치
uv sync

# 환경 변수 설정 (.env 파일에 Azure OpenAI 자격 증명 구성)

# 에이전트 실행
python main.py

# 클라이언트 실행
uv run client.py
```

---

## 관련 링크

- **GitHub**: [leonardo204/a2a_sample](https://github.com/leonardo204/a2a_sample)

---

*이 프로젝트는 A2A 프로토콜을 활용한 멀티 에이전트 오케스트레이션 시스템 구현 프로젝트입니다.*
