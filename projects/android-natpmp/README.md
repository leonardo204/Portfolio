# Android NAT-PMP

🌐 **Language**: [한국어](./README.md) | [English](./README_EN.md)

> Android 셋톱박스용 NAT-PMP(NAT Port Mapping Protocol) 구현 라이브러리

![Platform](https://img.shields.io/badge/platform-Android-3DDC84)
![Java](https://img.shields.io/badge/Java-ED8B00?logo=openjdk&logoColor=white)

---

## 개요

**Android NAT-PMP**는 Android 셋톱박스 환경에서 NAT 통과(NAT Traversal)를 위한 NAT-PMP 프로토콜 구현 라이브러리입니다.

공유기(NAT Gateway) 뒤에 있는 셋톱박스가 외부 IP 주소를 획득하고, UDP/TCP 포트 매핑을 수행하여 양방향 통신을 가능하게 합니다.

---

## 주요 기능

### NAT-PMP 프로토콜
- **외부 IP 주소 획득**: Gateway에서 공인 IP 조회
- **포트 매핑**: UDP/TCP 포트 자동 매핑
- **수명 관리**: 매핑 갱신 및 해제 자동화

### 네트워크 관리
- **네트워크 상태 모니터링**: 연결/해제 이벤트 감지
- **자동 재연결**: 네트워크 복구 시 매핑 재설정
- **Gateway 자동 탐지**: RFC1918 주소 기반 탐지

---

## 아키텍처

```
┌─────────────────────────────────────────────────────────┐
│                 Android Set-top Box                      │
│  ┌───────────────────────────────────────────────────┐  │
│  │              NatPmpManager                         │  │
│  │  ┌─────────────┐  ┌─────────────┐                 │  │
│  │  │ External IP │  │ Port Mapper │                 │  │
│  │  │   Request   │  │  (UDP/TCP)  │                 │  │
│  │  └─────────────┘  └─────────────┘                 │  │
│  └───────────────────────────────────────────────────┘  │
│                          │                               │
│                    NAT-PMP (UDP)                         │
│                          │                               │
│                          ▼                               │
│  ┌───────────────────────────────────────────────────┐  │
│  │            NAT Gateway (Router)                    │  │
│  │         External IP: xxx.xxx.xxx.xxx              │  │
│  └───────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────┘
```

---

## 기술 스택

| 분류 | 기술 |
|------|------|
| **플랫폼** | Android (API 21+) |
| **언어** | Java |
| **네트워크** | UDP DatagramSocket |
| **프로토콜** | NAT-PMP (RFC 6886) |

---

## 해결한 문제

### 1. NAT 환경에서의 양방향 통신
**문제**: NAT 뒤의 셋톱박스가 외부에서 접근 불가능

**해결**: NAT-PMP를 통해 공유기에 포트 매핑을 요청하여 외부에서 접근 가능한 포트 확보

### 2. 네트워크 상태 변화 대응
**문제**: 네트워크 재연결 시 매핑 정보 손실

**해결**: NetworkStateManager를 통해 네트워크 상태를 모니터링하고 재연결 시 자동으로 매핑 재설정

---

## 역할 및 기여

- NAT-PMP 프로토콜 클라이언트 구현
- 네트워크 상태 관리 시스템 개발
- 포트 매핑 자동 갱신 로직 구현
- 셋톱박스 플랫폼 통합

---

*이 프로젝트는 케이블 TV 셋톱박스의 IP VOD 서비스 지원을 위해 개발되었습니다.*
